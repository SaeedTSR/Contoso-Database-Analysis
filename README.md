# üìä Contoso Retail: Advanced Customer Analytics

## üìå Project Overview
This project performs a deep-dive **Customer Analytics** analysis on the Contoso Retail dataset. It moves beyond basic sales reporting to answer critical business questions about customer lifetime value (LTV), retention, churn, and segmentation. The goal is to identify the most valuable customer cohorts, understand churn patterns, and provide actionable insights for targeted marketing strategies.

## üõ†Ô∏è Tools & Technologies
- **Database:** PostgreSQL
- **SQL Concepts Demonstrated:**
  - **Advanced SQL:** Complex Common Table Expressions (CTEs), Window Functions, Conditional Aggregation.
  - **View Creation:** Building reusable data layers for simplified analysis.
  - **Cohort Analysis:** Tracking groups of customers over time.
  - **Customer Segmentation:** Using percentiles for data-driven segmentation.
  - **Churn Analysis:** Implementing business logic to classify customer status.

## üîç Analysis Summary
The analysis is structured into four sequential SQL files, each building upon the last to create a comprehensive picture of customer health.

### **File 1: `0_cohort_view.sql`**
- **Purpose:** Creates a foundational `cohort_analysis` view that enriches the raw sales data with customer details and calculates key metrics.
- **Key Operations:**
  - Joins `sales` with `customer` tables.
  - Calculates `total_revenue` per customer per order (handling currency exchange).
  - Uses a window function (`MIN() OVER()`) to assign each customer to a **cohort_year** based on their first purchase date.
- **Why it's important:** This view simplifies all subsequent queries by pre-aggregating and defining the cohort, embodying the "DRY" (Don't Repeat Yourself) principle in SQL.

### **File 2: `1_cohort_analysis.sql`**
- **Purpose:** Performs a high-level **Cohort Analysis** to understand the overall value of customer groups acquired in different years.
- **Key Metrics:**
  - `total_revenue`: Total revenue generated by each cohort.
  - `customer_count`: Number of customers in each cohort.
  - `revenue_per_customer`: The average LTV for a customer in a given cohort.
- **Business Question Answered:** "Which year's customers have been the most valuable overall?"

### **File 3: `2_customer_segmentation.sql`**
- **Purpose:** Segments all customers into **High, Mid, and Low Value** groups based on their total Lifetime Value (LTV).
- **Key Operations:**
  - Calculates total LTV for each customer.
  - Uses `PERCENTILE_CONT` to find the 25th and 75th percentile LTV values, creating dynamic segmentation thresholds.
  - Classifies customers using a `CASE` statement against these percentiles.
  - Summarizes the total value and average LTV for each segment.
- **Business Question Answered:** "How do our customer segments break down, and what is the value of our top-tier customers?"

### **File 4: `3_customer_churn.sql`**
- **Purpose:** Identifies **"Churned"** vs. **"Active"** customers based on their purchase history.
- **Key Operations:**
  - Finds the first and last purchase date for each customer.
  - Defines a customer as **"Churned"** if their last purchase was more than **6 months** ago from the latest date in the dataset. Otherwise, they are "Active".
  - Breaks down the churn/active status by cohort year to see if older customers are more likely to churn.
  - Calculates the percentage of churned vs. active customers per cohort.
- **Business Question Answered:** "What is our customer retention rate by cohort, and how many customers have we lost?"

## üìà Key Insights
Based on the analysis:

-   **Valuable Cohorts:** The cohort from `[Year X]` has the highest `revenue_per_customer`, indicating a highly valuable customer group.
-   **Segment Concentration:** A small percentage of "High Value" customers (the top 25% by LTV) likely contribute a disproportionately large share of the total revenue (Pareto Principle).
-   **Churn Rate:** The `[Year Y]` cohort might show a higher churn rate, suggesting issues with retaining customers acquired that year.
-   **Retention Opportunity:** There is a clear opportunity to create targeted marketing campaigns aimed at "Mid Value" customers to move them into the "High Value" segment and win back "Churned" customers from the most valuable cohorts.


## üöÄ How to Run This Project
1.  **Prerequisites:** Ensure you have a PostgreSQL database with the Contoso schema loaded (`sales` and `customer` tables must exist).
2.  **Execute in Order:** Run the SQL scripts in numerical order:
    ```bash
    psql -d your_database -f 0_cohort_view.sql
    psql -d your_database -f 1_cohort_analysis.sql
    # ... and so on
    ```
3.  **Analyze Results:** The output of each query provides a clear table of results answering a specific business question.

## üë®‚Äçüíª Author
**Saeed Roostaei**
- [![LinkedIn](https://img.shields.io/badge/LinkedIn-Profile-blue?style=flat&logo=linkedin)](https://www.linkedin.com/in/saeed-roostaei-8b46b2227?lipi=urn%3Ali%3Apage%3Ad_flagship3_profile_view_base_contact_details%3BUMhGi4eZQTutv%2FKL9NwfDg%3D%3D)
- [![GitHub](https://img.shields.io/badge/GitHub-Portfolio-black?style=flat&logo=github)](https://github.com/SaeedTSR)

---

***Disclaimer:** This project uses a modified version of the Contoso dataset. The schema and analysis are based on the provided SQL files.*